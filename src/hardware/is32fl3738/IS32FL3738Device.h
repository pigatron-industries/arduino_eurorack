#ifndef IS32FL3738Device_h
#define IS32FL3738Device_h

#include "../device/DevicePin.h"
#include <Wire.h>

#define IS32_ADDRESS_A 0b1010000
#define IS32_ADDRESS_B 0b1010101
#define IS32_ADDRESS_C 0b1011010
#define IS32_ADDRESS_D 0b1011111

#define IS32FL3738_PINCOUNT 48
#define IS32FL3738_PINDEF(PIN) AnalogOutputPin<IS32FL3738Device>(*this, PIN, 8, 0, 1)


class IS32FL3738Device : public Device, public DigitalOutputDevice, public AnalogOutputDevice {
    public:
        IS32FL3738Device(TwoWire& wire, uint8_t address = IS32_ADDRESS_A);
        void init();
        void digitalWrite(uint8_t pin, bool value);
        void analogWrite(uint8_t pin, uint16_t value);

        AnalogOutputPin<IS32FL3738Device> pins[IS32FL3738_PINCOUNT] = { 
            IS32FL3738_PINDEF(0), IS32FL3738_PINDEF(1), IS32FL3738_PINDEF(2), IS32FL3738_PINDEF(3), IS32FL3738_PINDEF(4), IS32FL3738_PINDEF(5),
            IS32FL3738_PINDEF(6), IS32FL3738_PINDEF(7), IS32FL3738_PINDEF(8), IS32FL3738_PINDEF(9), IS32FL3738_PINDEF(10),IS32FL3738_PINDEF(11),
            IS32FL3738_PINDEF(12),IS32FL3738_PINDEF(13),IS32FL3738_PINDEF(14),IS32FL3738_PINDEF(15),IS32FL3738_PINDEF(16),IS32FL3738_PINDEF(17),
            IS32FL3738_PINDEF(18),IS32FL3738_PINDEF(19),IS32FL3738_PINDEF(20),IS32FL3738_PINDEF(21),IS32FL3738_PINDEF(22),IS32FL3738_PINDEF(23),
            IS32FL3738_PINDEF(24),IS32FL3738_PINDEF(25),IS32FL3738_PINDEF(26),IS32FL3738_PINDEF(27),IS32FL3738_PINDEF(28),IS32FL3738_PINDEF(29),
            IS32FL3738_PINDEF(30),IS32FL3738_PINDEF(31),IS32FL3738_PINDEF(32),IS32FL3738_PINDEF(33),IS32FL3738_PINDEF(34),IS32FL3738_PINDEF(35),
            IS32FL3738_PINDEF(36),IS32FL3738_PINDEF(37),IS32FL3738_PINDEF(38),IS32FL3738_PINDEF(39),IS32FL3738_PINDEF(40),IS32FL3738_PINDEF(41),
            IS32FL3738_PINDEF(42),IS32FL3738_PINDEF(43),IS32FL3738_PINDEF(44),IS32FL3738_PINDEF(45),IS32FL3738_PINDEF(46),IS32FL3738_PINDEF(47)
        };

    private:
        TwoWire& wire;
        uint8_t address;

        void setOnOffRegisters();
        void writeRegister(uint8_t reg, uint8_t data);
        void selectPage(uint8_t page);
};

#endif
